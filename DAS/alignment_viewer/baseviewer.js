// Generated by CoffeeScript 1.12.2
(function() {
  var contig_height, fill, h, query_height, spacer, svg, tooltip, w, xpadding, y;

  w = 960;

  h = 5000;

  svg = d3.select('body').append('svg').attr('width', w).attr('height', h);

  xpadding = 50.0;

  y = 50;

  spacer = 12;

  query_height = 10;

  contig_height = 7;

  tooltip = d3.select("body").append("div").attr("class", "tooltip");

  d3.json('data.json', function(data) {
    var query_len, xScale, yScale, yend;
    query_len = data.contigs[0].query_length;
    xScale = d3.scaleLinear().domain([0, query_len]).range([0 + xpadding, w - xpadding]);
    yScale = d3.scaleLinear().domain([0, data.contigs.length]).range([y, data.contigs.length * spacer]);
    yend = yScale(data.contigs.length + 2);
    svg.append('text').attr('x', xScale(query_len / 2.0)).attr('y', yScale(-2)).attr("text-anchor", "middle").text(function(d) {
      return data.meta.query + " (" + data.meta.query_length + " bp)";
    });
    svg.append('rect').attr('x', xScale(0)).attr('width', xScale(query_len)).attr('y', yScale(0)).attr('height', query_height).attr('opacity', 0.5).attr('fill', 'blue');
    svg.append('line').attr('x1', xScale(query_len / 2.0)).attr('y1', yScale(0)).attr('x2', xScale(query_len / 2.0)).attr('y2', yend).style("stroke-dasharray", "3, 3").style("stroke", 'black').style("stroke-width", 1.5);
    svg.selectAll('rects').data(data.contigs).enter().append('rect').attr('x', function(d) {
      return xScale(d.q_start);
    }).attr('y', function(d, i) {
      return yScale(i + 2);
    }).attr('width', function(d) {
      return xScale(d.q_end) - xScale(d.q_start);
    }).attr('height', contig_height).attr('fill', fill).attr('opacity', 0.9).on("mouseover", function(d) {
      var coordinates;
      coordinates = d3.mouse(this);
      d3.select(this).style("fill", 'red');
      return tooltip.html('<b>Subject: </b>' + d.subject_acc + '<br>' + '<b>Range:\t</b> ' + d.q_start + '-' + d.q_end + '<br>' + '<b>Type:\t</b>' + d.contig_type + '<br>' + '<b>Id:\t</b>' + d.contig_id).style("visibility", "visible");
    }).on("mousemove", function() {
      return tooltip.style("top", (d3.event.pageY - 10) + "px").style("left", (d3.event.pageX + 10) + "px");
    }).on("mouseout", function(d) {
      d3.select(this).style('fill', fill);
      return tooltip.style("visibility", "hidden");
    });
    svg.selectAll('rects').data(data.contigs).enter().append('rect').attr('x', function(d) {
      return xScale(d.q_start);
    }).attr('y', function(d, i) {
      return yScale(1);
    }).attr('width', 1).attr('height', yend - yScale(1)).attr('fill', 'black').attr('opacity', 0.1);
    svg.selectAll('rects').data(data.contigs).enter().append('rect').attr('x', function(d) {
      return xScale(d.q_end);
    }).attr('y', function(d, i) {
      return yScale(1);
    }).attr('width', 1).attr('height', yend - yScale(1)).attr('fill', 'blue').attr('opacity', 0.1);
    d3.json('primer_data.json', function(primerdata) {
      return svg.selectAll('primer_rects').data(primerdata.contigs).enter().append('rect').attr('x', function(d) {
        return xScale(d.q_start);
      }).attr('y', function(d, i) {
        return yScale(0);
      }).attr('width', function(d) {
        return xScale(d.q_end) - xScale(d.q_start);
      }).attr('height', query_height * 0.75).attr('fill', "red").attr('opacity', 1.35);
    });
    return d3.json('primer_data.json', function(primerdata) {
      return svg.selectAll('primer_text').data(primerdata.contigs).enter().append('text').append('text').attr('x', function(d) {
        return xScale(d.q_start);
      }).attr('y', function(d, i) {
        return yScale(-2);
      }).text('OK');
    });
  });

  fill = function(d) {
    if (d.contig_type === 'contig') {
      return 'black';
    }
    if (d.contig_type === 'product') {
      return 'purple';
    }
    if (d.contig_type === 'gap') {
      return 'blue';
    }
    return 'orange';
  };

}).call(this);

//# sourceMappingURL=baseviewer.js.map
